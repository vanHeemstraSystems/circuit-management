ARG IMAGE_REPOSITORY
# pull official base image, see https://hub.docker.com/r/hasura/graphql-engine/tags?page=1&name=cli-migrations-v3
FROM ${IMAGE_REPOSITORY}/hasura/graphql-engine:v2.26.0.cli-migrations-v3
# FROM ${IMAGE_REPOSITORY}/hasura/graphql-engine:v2.26.0

# See https://stackoverflow.com/questions/29261811/use-docker-compose-env-variable-in-dockerbuild-file
ARG PROXY_USER
ARG PROXY_PASSWORD
ARG PROXY_FQDN
ARG PROXY_PORT
ARG HASURA_GRAPHQL_METADATA_DATABASE_URL
ARG PG_DATABASE_URL
ARG HASURA_GRAPHQL_ENABLE_CONSOLE
ARG HASURA_GRAPHQL_DEV_MODE
ARG HASURA_GRAPHQL_ENABLED_LOG_TYPES
ARG HASURA_GRAPHQL_CONSOLE_ASSETS_DIR
ARG HASURA_GRAPHQL_ADMIN_SECRET

ENV HTTP_PROXY="http://${PROXY_USER}:${PROXY_PASSWORD}@${PROXY_FQDN}:${PROXY_PORT}"
ENV HTTPS_PROXY="http://${PROXY_USER}:${PROXY_PASSWORD}@${PROXY_FQDN}:${PROXY_PORT}"

ENV HASURA_GRAPHQL_METADATA_DATABASE_URL="${HASURA_GRAPHQL_METADATA_DATABASE_URL}"
ENV PG_DATABASE_URL="${PG_DATABASE_URL}"
ENV HASURA_GRAPHQL_ENABLE_CONSOLE="${HASURA_GRAPHQL_ENABLE_CONSOLE}"
ENV HASURA_GRAPHQL_DEV_MODE="${HASURA_GRAPHQL_DEV_MODE}"
ENV HASURA_GRAPHQL_ENABLED_LOG_TYPES="${HASURA_GRAPHQL_ENABLED_LOG_TYPES}"
ENV HASURA_GRAPHQL_CONSOLE_ASSETS_DIR="${HASURA_GRAPHQL_CONSOLE_ASSETS_DIR}"
ENV HASURA_GRAPHQL_ADMIN_SECRET="${HASURA_GRAPHQL_ADMIN_SECRET}"

# expose port
EXPOSE 8080